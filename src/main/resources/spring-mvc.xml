<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/mvc
       https://www.springframework.org/schema/mvc/spring-mvc.xsd">


    <!-- 配置SpringMVC -->
    <!--    1. 开启SpringMVC注解驱动 -->
    <mvc:annotation-driven>
        <!--        字符配置-->
        <mvc:message-converters>
            <bean class="org.springframework.http.converter.StringHttpMessageConverter">
                <property name="supportedMediaTypes" value="text/html;charset=utf-8"/>
            </bean>
        </mvc:message-converters>

    </mvc:annotation-driven>
    <!--    2. 静态资源默认servlet配置-->
    <mvc:default-servlet-handler/>
    <!--    3. 视图配置-->
    <!--    https://www.cnblogs.com/doondo/p/13665702.html-->
    <!--    3.1 html视图解析 -->
    <bean id="freemarkerConfiguration"
          class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <property name="location" value="classpath:freemarker.properties"/>
<!--        <property name="locations">-->
<!--            <list>-->
<!--                <value>classpath*:freemarker.properties</value>-->
<!--            </list>-->
<!--        </property>-->
    </bean>
    <bean id="freeMarkerConfigurer"
          class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">

        <property name="templateLoaderPath">
            <value>/WEB-INF/view/</value>
        </property>
        <property name="freemarkerSettings" ref="freemarkerConfiguration"/>
    </bean>
    <bean id="htmlviewResolver"
          class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver">
        <property name="suffix" value=".html"/>
        <property name="order" value="0"></property>
        <property name="contentType" value="text/html;charset=UTF-8"></property>
    </bean>
    <!--    3.2 jsp 视图解析 -->
    <!--    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">-->
    <!--        <property name="prefix" value="/WEB-INF/jsp/"></property>-->
    <!--        <property name="suffix" value=".jsp"></property>-->
    <!--        <property name="order" value="2"></property>-->
    <!--    </bean>-->

    <!-- 配置freeMarker视图解析器 -->
    <bean id="freemarkerViewResolver"
          class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver">
        <property name="viewClass" value="org.springframework.web.servlet.view.freemarker.FreeMarkerView"
        />
        <property name="viewNames" value="*.ftl"/>
        <property name="contentType" value="text/html; charset=utf-8"/>
        <property name="cache" value="true"/>
        <property name="suffix" value=""/>
        <!-- 	<property name="exposeRequestAttributes" value="true" />
            <property name="exposeSessionAttributes" value="true" />
            <property name="exposeSpringMacroHelpers" value="true" /> -->
        <property name="order" value="0"/>
    </bean>
    <!-- 对模型视图名称的解析，即在模型视图名称添加前后缀 通用解析器 -->
    <bean id="viewResolver"
          class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value=""/>
        <property name="viewNames" value="*.html,*.jsp"/>
        <property name="suffix" value=""/>
        <property name="viewClass"
                  value="org.springframework.web.servlet.view.InternalResourceView"/>
        <property name="order" value="1"></property>
    </bean>
    <!--    4. swagger 生成api-->
    <!--重要！将你的SwaggerConfig配置类注入-->
    <bean class="xhmy.cloud.swagger.SwaggerConfig"/>
    <!--重要！配置swagger资源不被拦截-->
    <mvc:resources mapping="swagger-ui.html" location="classpath:/META-INF/resources/"/>
    <mvc:resources mapping="/webjars/**" location="classpath:/META-INF/resources/webjars/"/>

    <!--    5. 扫描web相关的bean -->
    <context:component-scan base-package="xhmy.cloud.controller"/>

    <!--    6. 文件上传-->
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <!-- 20mb -->
        <property name="maxUploadSize" value="20971520"/>
        <property name="defaultEncoding" value="UTF-8"/>
    </bean>
    <!--    7. 异常处理 -->
    <!--    <bean class="dm.net.exception.MyHandlerExceptionResolver"/>-->
    <!--    <bean id="exceptionHandler" class="dm.net.exception.ControllerException"></bean>-->

    <!--    8. 拦截器-->
<!--    <mvc:interceptors>-->
<!--        <mvc:interceptor>-->
<!--            &lt;!&ndash; 拦截所有mvc控制器 &ndash;&gt;-->
<!--            <mvc:mapping path="/**"/>-->
<!--            &lt;!&ndash; mvc:exclude-mapping是另外一种拦截，它可以在你后来的测试中对某个页面进行不拦截，这样就不用在-->
<!--                MyInterceptor的preHandler方法里面获取不拦截的请求uri地址了(优选) &ndash;&gt;-->
<!--            &lt;!&ndash; home &ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/index*"/>-->
<!--            <mvc:exclude-mapping path="/favicon.ico"/>-->
<!--            &lt;!&ndash;    放行用户注册登录找回密码&ndash;&gt;-->
<!--            &lt;!&ndash;    user&ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/*Login*" />-->
<!--            <mvc:exclude-mapping path="/*login*"/>-->
<!--            <mvc:exclude-mapping path="/**/*register*"/>-->
<!--            <mvc:exclude-mapping path="/**/*forgot"/>-->
<!--            <mvc:exclude-mapping path="/**/*Register*"/>-->
<!--            <mvc:exclude-mapping path="/**/*Forgot"/>-->
<!--            &lt;!&ndash;    admin 注册时 放行ajax验证用户唯一性的请求&ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/checkRegister"/>-->
<!--            &lt;!&ndash;    放行验证码请求 &ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/code"/>-->
<!--            &lt;!&ndash;    用户注册时 放行ajax验证用户唯一性的请求 &ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/**/*judgeEmail*"/>-->
<!--            &lt;!&ndash;    放行游客浏览页面&ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/browse/**"/>-->
<!--            &lt;!&ndash;    放行静态资源&ndash;&gt;-->
<!--            &lt;!&ndash;    最好将静态资源放在一个文件下&ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/static/**"/>-->
<!--            &lt;!&ndash;    放行插件&ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/plugins/**"/>-->
<!--            &lt;!&ndash;    放行swagger2-controller api文档 &ndash;&gt;-->
<!--            <mvc:exclude-mapping path="/swagger-ui.html"/>-->

<!--            &lt;!&ndash;    注入拦截器&ndash;&gt;-->
<!--            <bean class="cloud.xhmy.interceptor.AllInterceptor"/>-->
<!--        </mvc:interceptor>-->

<!--        <mvc:interceptor>-->
<!--            <mvc:mapping path="/admin/**"/>-->
<!--            <mvc:exclude-mapping path="/*Login*" />-->
<!--            <mvc:exclude-mapping path="/*login*"/>-->
<!--            <mvc:exclude-mapping path="/*register*"/>-->
<!--            <mvc:exclude-mapping path="/*forgot"/>-->
<!--            <mvc:exclude-mapping path="/*Register*"/>-->
<!--            <mvc:exclude-mapping path="/*Forgot"/>-->
<!--            <bean class="cloud.xhmy.interceptor.PermissionsInterceptor"/>-->
<!--        </mvc:interceptor>-->

<!--        <mvc:interceptor>-->
<!--            <mvc:mapping path="/login"/>-->
<!--            <mvc:mapping path="/admin/login"/>-->
<!--            <bean class="cloud.xhmy.interceptor.LoginInterceptor"></bean>-->
<!--        </mvc:interceptor>-->
<!--    </mvc:interceptors>-->

</beans>